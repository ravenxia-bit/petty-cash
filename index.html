<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ç°¡æ˜“é›¶ç”¨é‡‘ç³»çµ±</title>
<link rel="preconnect" href="https://pcash.ravenxia1205-801.workers.dev">
<link rel="dns-prefetch" href="https://pcash.ravenxia1205-801.workers.dev">
<style>
:root{ --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb;
--acc:#22d3ee; --danger:#ef4444; --ok:#22c55e; --line:#1f2937; --chip:#0b2a33 }
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
.wrap{max-width:1100px;margin:auto;padding:20px}
header{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:16px}
h1{font-size:20px;margin:0}
.actions{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
button,.btn{background:#0b2133;border:1px solid var(--line);color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
button:hover{border-color:#244b63}
.btn-primary{background:#082432;border-color:#0e3b52}
.btn-danger{background:#2a0f13;border-color:#511b21}
.btn-ghost{background:transparent}
.muted{color:var(--muted);font-size:13px}
.role-badge{padding:4px 8px;border-radius:999px;border:1px solid #0e3b52;background:#072133}
.inline-field{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.calendar-btn{padding:10px;border-radius:10px;border:1px solid var(--line);background:#0b2133;cursor:pointer}
.calendar-btn:hover{border-color:#244b63}
.invalid{border-color:var(--danger)!important; outline: none}

.summary{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:14px 0 8px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px}
.card h3{margin:0 0 4px;font-size:13px;color:var(--muted)}
.card .val{font-size:22px;font-weight:700}
.val.in{color:var(--ok)} .val.out{color:var(--danger)} .val.bal{color:var(--acc)}
.hint{margin:0 0 12px}

.toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
.toolbar input,.toolbar select{background:#0b1220;border:1px solid var(--line);color:var(--text);padding:10px;border-radius:10px}

/* ====== æ—¥æœŸå€é–“ï¼šæ¡Œæ©Ÿèˆ‡æ‰‹æ©Ÿæ’ç‰ˆ ====== */
.date-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.date-group{display:grid;grid-template-columns:auto minmax(160px,1fr) auto;gap:8px;align-items:center}
.date-group label{white-space:nowrap}
.tilde{white-space:nowrap}
.tilde-mobile{display:none} /* åƒ…æ‰‹æ©Ÿé¡¯ç¤º */

.table-wrap{background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden}
table{width:100%;border-collapse:collapse;min-width:760px}
th,td{padding:12px 10px;border-bottom:1px solid var(--line);text-align:left;font-size:14px}
th{color:var(--muted);font-weight:600;background:#0c1526}
tr:hover td{background:#0a1422}
.chip{display:inline-block;font-size:12px;padding:4px 8px;border-radius:999px;background:var(--chip);border:1px solid #103543}
.money.in{color:var(--ok);font-weight:700}
.money.out{color:var(--danger);font-weight:700}
.empty{padding:24px;color:var(--muted);text-align:center}
.disabled{opacity:.5;pointer-events:none}
.amt-input{width:100%; background:#0b1220;border:1px solid var(--line);color:var(--text);padding:8px;border-radius:10px}

.table-scroller{overflow:auto}
@media (max-width: 720px){
  .summary{grid-template-columns:1fr}
  .toolbar{flex-direction:column}
  /* æ‰‹æ©Ÿï¼šå…©è¡Œå‘ˆç¾ï¼Œæ¯è¡Œ= æ¨™ç±¤ + æ—¥æœŸè¼¸å…¥ + æŒ‰éˆ• */
  .date-row{display:grid;gap:8px}
  .date-group{grid-template-columns:auto 1fr auto}
  .tilde{display:none}         /* éš±è—ä¸­é–“çš„ ~ */
  .tilde-mobile{display:inline}/* æ”¹åœ¨ç¬¬äºŒè¡Œæ¨™ç±¤å‰é¢é¡¯ç¤º ~ */
  .table-wrap{border:none;background:transparent}
  table{display:none}
  .list{display:grid;gap:10px}
  .row-card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;display:grid;gap:8px}
  .row-top{display:flex;justify-content:space-between;gap:8px;align-items:center}
  .row-mid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .row-note{color:var(--muted);font-size:13px}
  .row-actions{display:flex;gap:8px;justify-content:flex-end}
}

.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(5,10,20,.6);padding:16px;z-index:40}
.modal.show{display:flex}
.dialog{width:100%;max-width:600px;background:var(--card);border:1px solid var(--line);border-radius:16px}
.dialog header{padding:14px 16px;border-bottom:1px solid var(--line)}
.dialog .body{padding:16px;display:grid;gap:12px}
.dialog footer{padding:12px 16px;border-top:1px solid var(--line);display:flex;gap:10px;justify-content:flex-end}
.form-row{display:grid;gap:8px}
.form-row.inline{grid-template-columns:1fr 1fr;gap:10px}
label{font-size:13px;color:var(--muted)}
input[type="text"], input[type="number"], input[type="date"], select{
  background:#0b1220;border:1px solid var(--line);color:var(--text);padding:10px;border-radius:10px;width:100%
}
.req::after{content:"*";color:var(--danger);margin-left:4px}

.login .dialog{max-width:460px}
.login h3{margin:0 0 6px;font-size:18px}
.login .role-cta{display:flex;gap:8px;flex-wrap:wrap}
.warn{font-size:12px;color:#eab308}

.loading{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.35);z-index:50}
.loading.show{display:flex}
</style>
</head>
<body>
<div class="wrap">
<header>
  <h1>ç°¡æ˜“é›¶ç”¨é‡‘ç³»çµ±</h1>
  <div class="actions">
    <span id="roleBadge" class="role-badge muted">æœªç™»å…¥</span>
    <button id="loginBtn" class="btn">ç™»å…¥ / åˆ‡æ›</button>
    <button id="logoutBtn" class="btn-ghost" style="display:none">ç™»å‡º</button>
    <span class="muted">|</span>
    <button id="addBtn" class="btn-primary">ï¼‹ æ–°å¢ç´€éŒ„</button>
    <button id="loadAllBtn" class="btn-ghost" title="è¼‰å…¥æ‰€æœ‰è³‡æ–™ï¼ˆå¯èƒ½è¼ƒæ…¢ï¼‰">è¼‰å…¥å…¨éƒ¨</button>
    <button id="exportBtn" class="btn">åŒ¯å‡º JSON</button>
    <label id="importWrap" class="btn-ghost" style="border:1px dashed var(--line);padding:8px 12px;border-radius:10px;cursor:pointer">
      åŒ¯å…¥ JSON <input id="importInput" type="file" accept="application/json" style="display:none">
    </label>
  </div>
</header>

<section class="summary">
  <div class="card"><h3>ç¸½æ”¶å…¥ï¼ˆç›®å‰è¼‰å…¥ï¼‰</h3><div class="val in" id="sumIn">0</div></div>
  <div class="card"><h3>ç¸½æ”¯å‡ºï¼ˆç›®å‰è¼‰å…¥ï¼‰</h3><div class="val out" id="sumOut">0</div></div>
  <div class="card"><h3>çµé¤˜ï¼ˆç›®å‰è¼‰å…¥ï¼‰</h3><div class="val bal" id="balance">0</div></div>
</section>
<p class="muted hint" id="loadHint" style="display:none">ç›®å‰åƒ…è¼‰å…¥æœ€è¿‘è³‡æ–™ã€‚è‹¥éœ€å®Œæ•´çµ±è¨ˆï¼Œè«‹é»å³ä¸Šè§’ã€Œè¼‰å…¥å…¨éƒ¨ã€ã€‚</p>

<!-- ===== ç¯©é¸å·¥å…·åˆ—ï¼ˆæ‰‹æ©Ÿï¼šå…©è¡Œï¼›æ¡Œæ©Ÿï¼šåŒæ’ï¼‰ ===== -->
<section class="toolbar">
  <div class="date-row">
    <div class="date-group">
      <label class="muted" for="dateFrom">èµ·å§‹æ—¥æœŸ</label>
      <input type="date" id="dateFrom" />
      <button id="openFromCal" class="calendar-btn" type="button" title="é–‹å•Ÿèµ·å§‹æ—¥æ›†">ğŸ“…</button>
      <input type="date" id="dateFromFallback" style="position:absolute;opacity:0;width:1px;height:1px;pointer-events:none" tabindex="-1" />
    </div>
    <span class="tilde muted">~</span>
    <div class="date-group">
      <label class="muted" for="dateTo"><span class="tilde-mobile">~ </span>çµæŸæ—¥æœŸ</label>
      <input type="date" id="dateTo" />
      <button id="openToCal" class="calendar-btn" type="button" title="é–‹å•ŸçµæŸæ—¥æ›†">ğŸ“…</button>
      <input type="date" id="dateToFallback" style="position:absolute;opacity:0;width:1px;height:1px;pointer-events:none" tabindex="-1" />
    </div>
  </div>

  <select id="typeFilter">
    <option value="">å…¨éƒ¨é¡å‹</option>
    <option value="income">æ”¶å…¥</option>
    <option value="expense">æ”¯å‡º</option>
  </select>
  <select id="categoryFilter"></select>

  <input type="text" id="kw" placeholder="æœå°‹å‚™è¨»é—œéµå­—â€¦" />
  <button id="applyFilters" class="btn-ghost">ä¾æ¢ä»¶æœå°‹</button>
  <button id="clearFilters" class="btn-ghost">æ¸…é™¤ç¯©é¸</button>
</section>

<section class="table-wrap">
  <div class="table-scroller">
    <table id="tbl">
      <thead>
        <tr>
          <th>æ—¥æœŸ</th>
          <th>é¡å‹</th>
          <th>åˆ†é¡</th>
          <th>å‚™è¨»</th>
          <th style="text-align:right">é‡‘é¡</th>
          <th style="width:180px">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
  <div class="list" id="list"></div>
  <div class="empty" id="empty" style="display:none">ç›®å‰æ²’æœ‰ç´€éŒ„</div>
</section>
</div>

<!-- æ–°å¢/ç·¨è¼¯ Modal -->
<div class="modal" id="entryModal" aria-hidden="true">
  <div class="dialog" ro
